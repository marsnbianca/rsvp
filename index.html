<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RSVP</title>
  <style>
    :root{
  --bg:transparent;
  --card:#f6f7fb;        /* light modal */
  --text:#141418;        /* dark text */
  --muted:#5a5a66;
  --line:#dcdde6;
  --err:#c62828;

  --btn:#141418;         /* primary = dark */
  --btnText:#ffffff;
}


    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:transparent;
      color:var(--text);
    }
    /* Modal layout */
    #modal{
  position: relative;
  z-index: 9999;

  width: min(420px, calc(100vw - 32px));
  margin: 16px auto;

  background: rgba(255, 255, 255, 0.80); /* white @ 80% */
  backdrop-filter: blur(6px); /* optional but very nice */
  -webkit-backdrop-filter: blur(6px);

  border-radius: 16px;
  border: 1px solid rgba(0,0,0,.08);
  box-shadow: 0 8px 30px rgba(0,0,0,.35);

  overflow: hidden;
  text-align: center;
}

    #header{
      padding:18px 18px 10px;
      border-bottom:1px solid var(--line);
      text-align:center;
    }
    #title{
      margin:0;
      font-size:20px;
      font-weight:700;
      letter-spacing:.2px;
    }
    #subtitle{
      margin:8px 0 0;
      font-size:13px;
      color:var(--muted);
      line-height:1.35;
    }

    #content{
      padding:16px 18px 18px;
      text-align:center;
    }

    #overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.60);
      z-index: 9998;
    }

    #modal{
      position: relative;
      z-index: 9999;
    }

    .row{display:flex; flex-direction:column; gap:10px; align-items:center;}
    label{
      display:block;
      font-size:13px;
      color:var(--muted);
      text-align:center;
    }
    input, select, textarea{
  width:100%;
  max-width: 360px;
  box-sizing:border-box;
  border-radius:12px;
  border:1px solid var(--line);
  background:#ffffff;
  color:var(--text);
  padding:12px 12px;
  outline:none;
  font-size:14px;
  text-align:center;
}

    textarea{min-height:92px; resize:vertical; text-align:center;}
    .muted{color:var(--muted); font-size:13px; line-height:1.35; text-align:center;}
    .error{
      width:100%;
      max-width: 360px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,107,107,.35);
      background: rgba(255,107,107,.08);
      color:var(--err);
      font-size:13px;
      text-align:center;
    }

    .btns{display:flex; gap:10px; justify-content:center; margin-top:8px; flex-wrap:wrap;}
    button{
      border:0;
      border-radius:12px;
      padding:11px 14px;
      font-weight:650;
      cursor:pointer;
      font-size:14px;
    button.primary{
  background: var(--btn);
  color: var(--btnText);
  border: none;
  min-width: 140px;
}

button.secondary{
  background: #ffffff;
  border: 1.5px solid var(--line);
  color: var(--text);
  min-width: 140px;
}

button.secondary:hover{
  background: #f0f1f6;
  border-color: #c9cada;
}


    button:disabled{opacity:.6; cursor:not-allowed;}

    .pillRow{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:4px;}
    .pill{
      background:transparent;
      border:1px solid var(--line);
      color:var(--text);
      min-width:150px;
    }
    .pill.active{
      background:rgba(255,255,255,.10);
      border-color:rgba(255,255,255,.22);
    }

    /* Pick list as buttons */
    .pickList{display:flex; flex-direction:column; gap:10px; width:100%; align-items:center;}
    .pickBtn{
      width:100%;
      max-width: 360px;
      text-align:center;
      background:transparent;
      border:1px solid var(--line);
      color:var(--text);
      padding:12px 14px;
      border-radius:12px;
      font-weight:700;
    }
    .pickBtn:hover{background:rgba(255,255,255,.06);}

    /* Loading */
    .loading{display:flex; align-items:center; justify-content:center; gap:10px; color:var(--muted); font-size:13px; margin-top:4px;}
    .dot{width:6px; height:6px; border-radius:50%; background:var(--muted); animation:b 1s infinite ease-in-out;}
    .dot:nth-child(2){animation-delay:.15s}
    .dot:nth-child(3){animation-delay:.3s}
    @keyframes b{0%,80%,100%{transform:scale(.7); opacity:.6} 40%{transform:scale(1.1); opacity:1}}

    /* Main close bar (top-right) */
    #closeWrap{
      padding:12px 18px 16px;
      border-top:1px solid var(--line);
      display:none;
      justify-content:center;
    }
    #closeBtn{
      background:transparent;
      border:1px solid var(--line);
      color:var(--text);
      min-width:180px;
    }
  </style>
</head>
<body>
  <div id="overlay" aria-hidden="true"></div>
  <div id="modal" role="dialog" aria-modal="true">
    <div id="header">
      <h1 id="title">RSVP</h1>
      <p id="subtitle"></p>
    </div>

    <div id="content"></div>

    <!-- Main close bar button (we will HIDE this on Thanks + Locked as requested) -->
    <div id="closeWrap">
      <button id="closeBtn">Close</button>
    </div>
  </div>

<script>
  const CONFIG = {
    webAppUrl: "https://script.google.com/macros/s/AKfycbxNMaS4bQoEICGBUa6uH5qL4BOGjhK_f1CajHkSWJkgDe_tTrbAM0KyWHKQd0YKQ4BMxA/exec",
    maxSeatsCap: 4
  };

  const state = {
    step: "find",
    loading: false,
    error: "",
    contactLine: "",
    nameQuery: "",
    matches: [],
    invite: null,

    attending: null,     // "yes" | "no"
    attendingCount: 1,
    attendeeNames: [],

    transportation: null, // "Yes" | "No"
    phoneDigits: "",
    notes: ""
  };

  const elTitle = document.getElementById("title");
  const elSubtitle = document.getElementById("subtitle");
  const elContent = document.getElementById("content");
  const elCloseWrap = document.getElementById("closeWrap");
  const elCloseBtn = document.getElementById("closeBtn");
  elCloseBtn.addEventListener("click", closeModal);

  function setHeader(title, subtitle) {
    elTitle.textContent = title;
    elSubtitle.textContent = subtitle || "";
  }

  function errorEl(msg) {
    const err = document.createElement("div");
    err.className = "error";
    err.textContent = msg;
    return err;
  }

  function pill(text, active, onClick) {
    const b = document.createElement("button");
    b.type = "button";
    b.className = "pill" + (active ? " active" : "");
    b.textContent = text;
    b.addEventListener("click", onClick);
    return b;
  }

  function clamp(n, a, b) {
    const x = Number(n);
    if (!Number.isFinite(x)) return a;
    return Math.min(Math.max(x, a), b);
  }

  function loadingRow() {
    const div = document.createElement("div");
    div.className = "loading";
    div.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span><span>Loading…</span>`;
    return div;
  }

  // CORS-safe request (no preflight)
  async function api(action, payload) {
    const res = await fetch(CONFIG.webAppUrl, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify({ action, ...(payload || {}) })
    });
    const text = await res.text();
    try { return JSON.parse(text); }
    catch (e) { return { ok: false, error: "Invalid server response.", raw: text }; }
  }

  function syncAttendeeNames_(maxSeats) {
    const cnt = clamp(Number(state.attendingCount || 1), 1, maxSeats);
    state.attendingCount = cnt;

    const arr = Array.isArray(state.attendeeNames) ? state.attendeeNames.slice(0, cnt) : [];
    while (arr.length < cnt) arr.push("");
    state.attendeeNames = arr;
  }

  function formatPH09_(digits) {
    const d = (digits || "").replace(/[^\d]/g, "").slice(0, 11);
    const p1 = d.slice(0, 4);
    const p2 = d.slice(4, 7);
    const p3 = d.slice(7, 11);
    if (d.length <= 4) return p1;
    if (d.length <= 7) return `${p1} ${p2}`;
    return `${p1} ${p2} ${p3}`;
  }

  function isValidPH09_(digits) {
    const d = (digits || "").replace(/[^\d]/g, "");
    return d.length === 11 && d.startsWith("09");
  }

  function toE164From09_(digits09) {
    const d = (digits09 || "").replace(/[^\d]/g, "");
    if (d.length !== 11 || !d.startsWith("09")) return "";
    return "+63" + d.slice(1); // +63917xxxxxxx
  }

  function render() {
    elContent.innerHTML = "";

    if (state.step === "find") return renderFind();
    if (state.step === "pick") return renderPick();
    if (state.step === "coming") return renderComing();
    if (state.step === "transpo") return renderTranspo();
    if (state.step === "phone") return renderPhone();
    if (state.step === "notes") return renderNotes();
    if (state.step === "locked") return renderLocked();
    if (state.step === "declined") return renderDeclined();
    if (state.step === "thanks") return renderThanks();

    state.step = "find";
    renderFind();
  }

  /* ---------------- FIND ---------------- */

  function renderFind() {
    setHeader("Find your invite", "Type the name on the invitation.");
    elCloseWrap.style.display = "none";

    const wrap = document.createElement("div");
    wrap.className = "row";

    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Full name";
    input.value = state.nameQuery;
    input.addEventListener("input", (e) => state.nameQuery = e.target.value);
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") onFind(); });
    wrap.appendChild(input);

    if (state.loading) wrap.appendChild(loadingRow());
    if (state.error) wrap.appendChild(errorEl(state.error));

    const btns = document.createElement("div");
    btns.className = "btns";

    const btn = document.createElement("button");
    btn.className = "primary";
    btn.type = "button";
    btn.textContent = "Find invite";
    btn.disabled = state.loading;
    btn.onclick = onFind;

    wrap.appendChild(btns);
    btns.appendChild(btn);

    elContent.appendChild(wrap);
    setTimeout(() => input.focus(), 0);
  }

  async function onFind() {
    state.error = "";
    const name = (state.nameQuery || "").trim();
    if (!name) { state.error = "Please type a name first."; return render(); }

    state.loading = true;
    render();

    try {
      const data = await api("find", { name });
      state.loading = false;

      if (!data || !data.ok) throw new Error(data?.error || "Search failed.");
      state.contactLine = data.contact_line || "";
      state.matches = Array.isArray(data.matches) ? data.matches : [];

      if (state.matches.length === 0) {
        state.error = "No match found. Try a different spelling.";
        return render();
      }

      state.step = "pick";
      render();
    } catch (err) {
      state.loading = false;
      state.error = String(err?.message || err);
      render();
    }
  }

  /* ---------------- PICK (Verification) ---------------- */

  function renderPick() {
    setHeader("Verify your name", "Tap your name to continue.");
    elCloseWrap.style.display = "none";

    const wrap = document.createElement("div");
    wrap.className = "row";

    const list = document.createElement("div");
    list.className = "pickList";

    state.matches.forEach((m) => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "pickBtn";
      b.textContent = m.invite_name || "Unnamed guest";
      b.onclick = () => onPick(m);
      list.appendChild(b);
    });

    wrap.appendChild(list);

    if (state.loading) wrap.appendChild(loadingRow());
    if (state.error) wrap.appendChild(errorEl(state.error));

    const btns = document.createElement("div");
    btns.className = "btns";

    const back = document.createElement("button");
    back.className = "secondary";
    back.type = "button";
    back.textContent = "Back";
    back.disabled = state.loading;
    back.onclick = () => { state.error = ""; state.step = "find"; render(); };

    btns.appendChild(back);
    wrap.appendChild(btns);

    elContent.appendChild(wrap);
  }

  async function onPick(m) {
    state.error = "";
    state.loading = true;
    render();

    try {
      const data = await api("get", { invite_id: m.invite_id });
      state.loading = false;

      if (!data || !data.ok) throw new Error(data?.error || "Could not load invite.");

      state.contactLine = data.contact_line || state.contactLine || "";
      state.invite = data.invite || null;

      if (!state.invite) throw new Error("Missing invite data.");

      if (state.invite.locked) {
        state.step = "locked";
        return render();
      }

      // reset answers
      state.attending = null;
      state.attendingCount = 1;
      state.attendeeNames = [];
      state.transportation = null;
      state.phoneDigits = "";
      state.notes = "";

      state.step = "coming";
      render();
    } catch (err) {
      state.loading = false;
      state.error = String(err?.message || err);
      render();
    }
  }

  /* ---------------- COMING ---------------- */

function renderComing() {
  const inviteName = state.invite?.invite_name || "Guest";
  const maxSeats = Math.min(Number(state.invite?.max_seats || 1), CONFIG.maxSeatsCap);

  setHeader("RSVP", `${inviteName}, are you coming?`);
  elCloseWrap.style.display = "none";

  const wrap = document.createElement("div");
  wrap.className = "row";

  const pills = document.createElement("div");
  pills.className = "pillRow";

  pills.appendChild(pill("Yes", state.attending === "yes", () => {
    state.attending = "yes";

    // If single invite: auto set attendee and skip name questions
    if (maxSeats === 1) {
      state.attendingCount = 1;
      state.attendeeNames = [inviteName];
    } else {
      state.attendingCount = clamp(state.attendingCount || 1, 1, maxSeats);
      syncAttendeeNames_(maxSeats);
    }

    state.error = "";
    render();
  }));

  pills.appendChild(pill("No", state.attending === "no", () => {
    state.attending = "no";
    state.attendingCount = 0;
    state.attendeeNames = [];
    state.error = "";
    render();
  }));

  wrap.appendChild(pills);

  // Only show count + names for party invites (maxSeats > 1)
  if (state.attending === "yes" && maxSeats > 1) {
    const select = document.createElement("select");
    for (let i = 1; i <= maxSeats; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `${i}`;
      if (i === Number(state.attendingCount || 1)) opt.selected = true;
      select.appendChild(opt);
    }
    select.onchange = (e) => {
      state.attendingCount = Number(e.target.value);
      syncAttendeeNames_(maxSeats);
      render();
    };
    wrap.appendChild(select);

    syncAttendeeNames_(maxSeats);

    const note = document.createElement("div");
    note.className = "muted";
    note.textContent = "Please enter the full name of each attendee.";
    wrap.appendChild(note);

    for (let i = 0; i < state.attendingCount; i++) {
      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = `Attendee ${i + 1} full name`;
      input.value = state.attendeeNames[i] || "";
      input.oninput = (e) => { state.attendeeNames[i] = e.target.value; };
      wrap.appendChild(input);
    }
  }

  if (state.loading) wrap.appendChild(loadingRow());
  if (state.error) wrap.appendChild(errorEl(state.error));

  const btns = document.createElement("div");
  btns.className = "btns";

  const back = document.createElement("button");
  back.className = "secondary";
  back.textContent = "Back";
  back.onclick = () => { state.error = ""; state.step = "pick"; render(); };

  const next = document.createElement("button");
  next.className = "primary";
  next.textContent = "Next";

  next.onclick = async () => {
    state.error = "";

    if (state.attending !== "yes" && state.attending !== "no") {
      state.error = "Please choose Yes or No.";
      return render();
    }

    // If NO: submit decline immediately and stop flow (if you already implemented this earlier)
    if (state.attending === "no") {
      state.loading = true;
      render();
      try {
        const payload = {
          invite_id: state.invite.invite_id,
          attending: "no",
          attending_count: 0,
          attendees: [],
          phone: "",
          transportation: "",
          notes: ""
        };
        const data = await api("submit", payload);
        state.loading = false;

        if (!data || !data.ok) {
          if (data && data.locked) {
            state.contactLine = data.contact_line || state.contactLine || "";
            state.step = "locked";
            return render();
          }
          throw new Error(data?.error || "Submit failed.");
        }

        state.step = "declined";
        return render();
      } catch (err) {
        state.loading = false;
        state.error = String(err?.message || err);
        return render();
      }
    }

    // YES path
    if (maxSeats === 1) {
      // auto set and skip straight to transpo
      state.attendingCount = 1;
      state.attendeeNames = [inviteName];
      state.step = "transpo";
      return render();
    }

    // Party invite validation
    const cleaned = (state.attendeeNames || [])
      .slice(0, state.attendingCount)
      .map(n => (n || "").trim());

    if (cleaned.length !== state.attendingCount || cleaned.some(n => !n)) {
      state.error = "Please fill in all attendee names.";
      return render();
    }

    state.step = "transpo";
    render();
  };

  btns.appendChild(back);
  btns.appendChild(next);
  wrap.appendChild(btns);

  elContent.appendChild(wrap);
}


  /* ---------------- TRANSPO ---------------- */

  function renderTranspo() {
    setHeader("Transportation", "Do you need transport arrangements from NAIA to the venue?");
    elCloseWrap.style.display = "none";

    const wrap = document.createElement("div");
    wrap.className = "row";

    const pills = document.createElement("div");
    pills.className = "pillRow";
    pills.appendChild(pill("Yes", state.transportation === "Yes", () => { state.transportation = "Yes"; state.error=""; render(); }));
    pills.appendChild(pill("No", state.transportation === "No", () => { state.transportation = "No"; state.error=""; render(); }));
    wrap.appendChild(pills);

    if (state.error) wrap.appendChild(errorEl(state.error));

    const btns = document.createElement("div");
    btns.className = "btns";

    const back = document.createElement("button");
    back.className = "secondary";
    back.textContent = "Back";
    back.onclick = () => { state.error=""; state.step = "coming"; render(); };

    const next = document.createElement("button");
    next.className = "primary";
    next.textContent = "Next";
    next.onclick = () => {
      state.error = "";
      if (state.transportation !== "Yes" && state.transportation !== "No") {
        state.error = "Please choose Yes or No.";
        return render();
      }
      state.step = "phone";
      render();
    };

    btns.appendChild(back);
    btns.appendChild(next);
    wrap.appendChild(btns);

    elContent.appendChild(wrap);
  }

  /* ---------------- PHONE ---------------- */

  function renderPhone() {
    setHeader("Mobile number", "Please enter your PH mobile number.");
    elCloseWrap.style.display = "none";

    const wrap = document.createElement("div");
    wrap.className = "row";

    const input = document.createElement("input");
    input.type = "tel";
    input.inputMode = "numeric";
    input.autocomplete = "tel";
    input.placeholder = "09XX XXX XXXX";
    input.value = formatPH09_(state.phoneDigits);

    input.oninput = (e) => {
      const digits = (e.target.value || "").replace(/[^\d]/g, "").slice(0, 11);
      state.phoneDigits = digits;
      e.target.value = formatPH09_(digits);
    };

    wrap.appendChild(input);

    if (state.error) wrap.appendChild(errorEl(state.error));

    const btns = document.createElement("div");
    btns.className = "btns";

    const back = document.createElement("button");
    back.className = "secondary";
    back.textContent = "Back";
    back.onclick = () => { state.error=""; state.step = "transpo"; render(); };

    const next = document.createElement("button");
    next.className = "primary";
    next.textContent = "Next";
    next.onclick = () => {
      state.error = "";
      if (!isValidPH09_(state.phoneDigits)) {
        state.error = "Please enter a valid PH mobile number (11 digits, starts with 09).";
        return render();
      }
      state.step = "notes";
      render();
    };

    btns.appendChild(back);
    btns.appendChild(next);
    wrap.appendChild(btns);

    elContent.appendChild(wrap);
    setTimeout(() => input.focus(), 0);
  }

  /* ---------------- NOTES ---------------- */

  function renderNotes() {
    setHeader("Notes", "Anything else? (Optional)");
    elCloseWrap.style.display = "none";

    const wrap = document.createElement("div");
    wrap.className = "row";

    const ta = document.createElement("textarea");
    ta.placeholder = "Type your notes here (optional)";
    ta.value = state.notes || "";
    ta.oninput = (e) => state.notes = e.target.value;
    wrap.appendChild(ta);

    if (state.loading) wrap.appendChild(loadingRow());
    if (state.error) wrap.appendChild(errorEl(state.error));

    const btns = document.createElement("div");
    btns.className = "btns";

    const back = document.createElement("button");
    back.className = "secondary";
    back.textContent = "Back";
    back.disabled = state.loading;
    back.onclick = () => { state.error=""; state.step = "phone"; render(); };

    const submit = document.createElement("button");
    submit.className = "primary";
    submit.textContent = state.loading ? "Submitting…" : "Submit RSVP";
    submit.disabled = state.loading;
    submit.onclick = onSubmit;

    btns.appendChild(back);
    btns.appendChild(submit);
    wrap.appendChild(btns);

    elContent.appendChild(wrap);
  }

  async function onSubmit() {
  state.error = "";

  if (!state.invite?.invite_id) {
    state.error = "Missing invite details. Please start again.";
    state.step = "find";
    return render();
  }

  if (state.attending !== "yes" && state.attending !== "no") {
    state.error = "Please choose Yes or No.";
    state.step = "coming";
    return render();
  }

  if (state.transportation !== "Yes" && state.transportation !== "No") {
    state.error = "Please choose Yes or No for transportation.";
    state.step = "transpo";
    return render();
  }

  if (!isValidPH09_(state.phoneDigits)) {
    state.error = "Please enter a valid PH mobile number (11 digits, starts with 09).";
    state.step = "phone";
    return render();
  }

  let attendees = [];
  let attending_count = 0;

  if (state.attending === "yes") {
    const maxSeats = Math.min(Number(state.invite.max_seats || 1), CONFIG.maxSeatsCap);

    // Single invite: do not ask attendee name, auto-use invite name
    if (maxSeats === 1) {
      attendees = [String(state.invite.invite_name || "").trim() || "Guest"];
      attending_count = 1;
    } else {
      const cnt = clamp(Number(state.attendingCount || 1), 1, maxSeats);

      attendees = (state.attendeeNames || []).slice(0, cnt).map(s => (s || "").trim());
      if (attendees.length !== cnt || attendees.some(x => !x)) {
        state.error = "Please fill in all attendee names.";
        state.step = "coming";
        return render();
      }
      attending_count = cnt;
    }
  }

  const payload = {
    invite_id: state.invite.invite_id,
    attending: state.attending,
    attending_count,
    attendees: state.attending === "yes" ? attendees : [],
    phone: toE164From09_(state.phoneDigits),
    transportation: state.transportation,
    notes: (state.notes || "").trim()
  };

  state.loading = true;
  render();

  try {
    const data = await api("submit", payload);
    state.loading = false;

    if (!data || !data.ok) {
      if (data && data.locked) {
        state.contactLine = data.contact_line || state.contactLine || "";
        state.step = "locked";
        return render();
      }
      throw new Error(data?.error || "Submit failed.");
    }

    state.step = "thanks";
    render();
  } catch (err) {
    state.loading = false;
    state.error = String(err?.message || err);
    render();
  }
}


  /* ---------------- LOCKED / THANKS ---------------- */

  function renderLocked() {
    setHeader("RSVP already received", "For changes, please contact the coordinator.");
    elCloseWrap.style.display = "none"; // remove main close bar button on this screen

    const wrap = document.createElement("div");
    wrap.className = "row";

    const msg = document.createElement("div");
    msg.className = "muted";
    msg.textContent = state.contactLine || "Please contact the coordinator for changes.";
    wrap.appendChild(msg);

    const btns = document.createElement("div");
    btns.className = "btns";

    const startOver = document.createElement("button");
    startOver.className = "secondary";
    startOver.textContent = "Start over";
    startOver.onclick = resetAll;

    const close = document.createElement("button");
    close.className = "primary";
    close.textContent = "Close";
    close.onclick = closeModal;

    btns.appendChild(startOver);
    btns.appendChild(close);
    wrap.appendChild(btns);

    elContent.appendChild(wrap);
  }

  function renderDeclined() {
  setHeader("Thank you!", "We’re so sorry you won’t be able to make it.");
  elCloseWrap.style.display = "none"; // main close bar hidden (as requested)

  const wrap = document.createElement("div");
  wrap.className = "row";

  const msg = document.createElement("div");
  msg.className = "muted";
  msg.textContent = "Thank you for letting us know.";
  wrap.appendChild(msg);

  const btns = document.createElement("div");
  btns.className = "btns";

  const close = document.createElement("button");
  close.className = "primary";
  close.textContent = "Close";
  close.onclick = closeModal;

  btns.appendChild(close);
  wrap.appendChild(btns);

  elContent.appendChild(wrap);
}

  function renderThanks() {
    setHeader("Thank you!", "See you soon.");
    elCloseWrap.style.display = "none"; // remove main close bar button on this screen

    const wrap = document.createElement("div");
    wrap.className = "row";

    const btns = document.createElement("div");
    btns.className = "btns";

    const close = document.createElement("button");
    close.className = "primary";
    close.textContent = "Close";
    close.onclick = closeModal;

    btns.appendChild(close);
    wrap.appendChild(btns);

    elContent.appendChild(wrap);
  }

  function resetAll() {
    state.step = "find";
    state.loading = false;
    state.error = "";
    state.nameQuery = "";
    state.matches = [];
    state.invite = null;

    state.attending = null;
    state.attendingCount = 1;
    state.attendeeNames = [];

    state.transportation = null;
    state.phoneDigits = "";
    state.notes = "";

    render();
  }

  function closeModal() {
  try {
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({ type: "RSVP_CLOSE" }, "*");
    }
  } catch (e) {}

  const overlay = document.getElementById("overlay");
  if (overlay) overlay.style.display = "none";

  const modal = document.getElementById("modal");
  if (modal) modal.style.display = "none";

  try { window.close(); } catch (e) {}
}

  document.getElementById("overlay").style.display = "block";
  document.getElementById("modal").style.display = "block";
  resetAll();

  resetAll();
</script>
</body>
</html>
